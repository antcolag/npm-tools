<!DOCTYPE html>
<html lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<meta http-equiv="X-UA-Compatible" content="ie=edge">
	<title>Tests</title>
	<script type="module" async src="./reactive.js"></script>
	<script type="module" async src="./observe.js"></script>
	<script type="module" async src="./tools.js"></script>
	<script type="module" async src="./test.js"></script>
	<script type="module" async src="./utils.js"></script>
	<script type="module" async src="./readable.js"></script>
	<script type="module" defer>
		import Test from "./test.js";
		import readable from "./readable.js";
		import {lisperato} from "./tools.js";
		import {
			apply,
			pipe,
			yes
		} from "./utils.js";
		import {
			croak,
			ASSERT,
			ASSERT_T,
			ASSERT_F,
		} from "./debug.js";

		new Test("tests shuld work", async function (arg) {
			var tests = new Test(
				"reactive and events shuld work",
				pipe
			)
			tests.bind("result", this, "reactiveResult")
			tests.on(
				"PASSED FAILED complete",
				ASSERT.bind(null, this.reactiveResult, tests.result)
			)
			await tests.run(true)

			await new Test(
				"failing tests shuld work",
				croak
			).die(true)

			await new Test(
				"shuld fail if description is not a String",
				() => new Test(-1).run()
			).die(true)

			readable.call(console)

			var i = 0;
			var timer = setInterval(()=>{
				console.log(`...${++i}`)
			}, 100)
			await new Test(
				"timed readable shuld work (.5 sec timer)",
				pipe
			).run(await console.read(500))
			clearInterval(timer)


			i = 0;
			timer = setInterval(()=>{
				console.log(`...${++i}`)
			}, 100)

			var timer2 = setTimeout(()=> {
				console.broadcast('ok')
			}, 200)
			await new Test(
				"readable shuld work (.5 sec timer)",
				pipe
			).run(await console.read(500))
			clearInterval(timer)
			clearInterval(timer2)


			try {
				return arg
			} finally {
				await new Test(
					"easter egg",
					(x, finder , ...[first, second]) => lisperato.car(lisperato.exec(lisperato.l(
						(s)=> lisperato.l(lisperato.l(first, lisperato.l(second, x))),
						(s)=> lisperato[finder](s)
					)))
				).run('abra', 'cadadr', 1,2)
			}
		}).run(true)
	</script>
</head>
<body>
	<h1>Tests</h1>
	<p>open the console</p>
</body>
</html>